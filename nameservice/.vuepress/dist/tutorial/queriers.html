<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queriers</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.0fa35ecc.css" as="style"><link rel="preload" href="/assets/js/app.358745d0.js" as="script"><link rel="preload" href="/assets/js/40.29b6dbc5.js" as="script"><link rel="prefetch" href="/assets/js/10.ed56b2dd.js"><link rel="prefetch" href="/assets/js/11.b9448339.js"><link rel="prefetch" href="/assets/js/12.d9540af2.js"><link rel="prefetch" href="/assets/js/13.8738af6e.js"><link rel="prefetch" href="/assets/js/14.7ef7ba9a.js"><link rel="prefetch" href="/assets/js/15.01af3069.js"><link rel="prefetch" href="/assets/js/16.5f272536.js"><link rel="prefetch" href="/assets/js/17.950b1488.js"><link rel="prefetch" href="/assets/js/18.97cd0ce2.js"><link rel="prefetch" href="/assets/js/19.c15b4c92.js"><link rel="prefetch" href="/assets/js/2.7459dab1.js"><link rel="prefetch" href="/assets/js/20.46ad9e71.js"><link rel="prefetch" href="/assets/js/21.1aaf8749.js"><link rel="prefetch" href="/assets/js/22.ed2cbdbe.js"><link rel="prefetch" href="/assets/js/23.d29efe89.js"><link rel="prefetch" href="/assets/js/24.6efbd344.js"><link rel="prefetch" href="/assets/js/25.99eafa78.js"><link rel="prefetch" href="/assets/js/26.59c51545.js"><link rel="prefetch" href="/assets/js/27.09db857f.js"><link rel="prefetch" href="/assets/js/28.de9e6f97.js"><link rel="prefetch" href="/assets/js/29.a95ec837.js"><link rel="prefetch" href="/assets/js/3.3b8bb6a2.js"><link rel="prefetch" href="/assets/js/30.ec4f2e27.js"><link rel="prefetch" href="/assets/js/31.39335b08.js"><link rel="prefetch" href="/assets/js/32.5e4a40ba.js"><link rel="prefetch" href="/assets/js/33.2d12c22c.js"><link rel="prefetch" href="/assets/js/34.6a06e4fa.js"><link rel="prefetch" href="/assets/js/35.37ad73ec.js"><link rel="prefetch" href="/assets/js/36.c90ef3a4.js"><link rel="prefetch" href="/assets/js/37.fcf1b3b5.js"><link rel="prefetch" href="/assets/js/38.549dbd91.js"><link rel="prefetch" href="/assets/js/39.c25f4a9a.js"><link rel="prefetch" href="/assets/js/4.ff53f1d1.js"><link rel="prefetch" href="/assets/js/41.003066df.js"><link rel="prefetch" href="/assets/js/42.59cc5a5a.js"><link rel="prefetch" href="/assets/js/43.5877f03f.js"><link rel="prefetch" href="/assets/js/44.97ed4d02.js"><link rel="prefetch" href="/assets/js/45.2be01aab.js"><link rel="prefetch" href="/assets/js/5.d936167e.js"><link rel="prefetch" href="/assets/js/6.f824f7e2.js"><link rel="prefetch" href="/assets/js/7.e6534aea.js"><link rel="prefetch" href="/assets/js/8.1b43487c.js"><link rel="prefetch" href="/assets/js/9.a7040e01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0fa35ecc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="queriers"><a href="#queriers" aria-hidden="true" class="header-anchor">#</a> Queriers</h1> <h2 id="query-types"><a href="#query-types" aria-hidden="true" class="header-anchor">#</a> Query Types</h2> <p>Start by creating the <code>./x/nameservice/types/querier.go</code> file. This is where you will define your querier types.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> types

<span class="token keyword">import</span> <span class="token string">&quot;strings&quot;</span>

<span class="token comment">// Query Result Payload for a resolve query</span>
<span class="token keyword">type</span> QueryResResolve <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Value <span class="token builtin">string</span> <span class="token string">`json:&quot;value&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// implement fmt.Stringer</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r QueryResResolve<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> r<span class="token punctuation">.</span>Value
<span class="token punctuation">}</span>

<span class="token comment">// Query Result Payload for a names query</span>
<span class="token keyword">type</span> QueryResNames <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>

<span class="token comment">// implement fmt.Stringer</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>n QueryResNames<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="querier"><a href="#querier" aria-hidden="true" class="header-anchor">#</a> Querier</h2> <p>Now you can create the <code>./x/nameservice/querier.go</code> file. This is the place to define which queries against application state users will be able to make. Your <code>nameservice</code> module will expose three queries:</p> <ul><li><code>resolve</code>: This takes a <code>name</code> and returns the <code>value</code> that is stored by the <code>nameservice</code>. This is similar to a DNS query.</li> <li><code>whois</code>: This takes a <code>name</code> and returns the <code>price</code>, <code>value</code>, and <code>owner</code> of the name. Used for figuring out how much names cost when you want to buy them.</li> <li><code>name</code> : This does not take a parameter, it returns all the names stored in the <code>nameservice</code> store.</li></ul> <p>Start by defining the <code>NewQuerier</code> function which acts as a sub-router for queries to this module (similar the <code>NewHandler</code> function). Note that because there isn't an interface similar to <code>Msg</code> for queries, you need to manually define switch statement cases (they can't be pulled off of the query <code>.Route()</code> function):</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> nameservice

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/cosmos/cosmos-sdk/codec&quot;</span>

	sdk <span class="token string">&quot;github.com/cosmos/cosmos-sdk/types&quot;</span>
	abci <span class="token string">&quot;github.com/tendermint/tendermint/abci/types&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// query endpoints supported by the nameservice Querier</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
	QueryResolve <span class="token operator">=</span> <span class="token string">&quot;resolve&quot;</span>
	QueryWhois   <span class="token operator">=</span> <span class="token string">&quot;whois&quot;</span>
	QueryNames   <span class="token operator">=</span> <span class="token string">&quot;names&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// NewQuerier is the module level router for state queries</span>
<span class="token keyword">func</span> <span class="token function">NewQuerier</span><span class="token punctuation">(</span>keeper Keeper<span class="token punctuation">)</span> sdk<span class="token punctuation">.</span>Querier <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> path <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> req abci<span class="token punctuation">.</span>RequestQuery<span class="token punctuation">)</span> <span class="token punctuation">(</span>res <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> err sdk<span class="token punctuation">.</span>Error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">switch</span> path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> QueryResolve<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token function">queryResolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> keeper<span class="token punctuation">)</span>
		<span class="token keyword">case</span> QueryWhois<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token function">queryWhois</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> keeper<span class="token punctuation">)</span>
		<span class="token keyword">case</span> QueryNames<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token function">queryNames</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">,</span> keeper<span class="token punctuation">)</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> sdk<span class="token punctuation">.</span><span class="token function">ErrUnknownRequest</span><span class="token punctuation">(</span><span class="token string">&quot;unknown nameservice query endpoint&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now that the router is defined, define the inputs and responses for each query:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// nolint: unparam</span>
<span class="token keyword">func</span> <span class="token function">queryResolve</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> path <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> req abci<span class="token punctuation">.</span>RequestQuery<span class="token punctuation">,</span> keeper Keeper<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> sdk<span class="token punctuation">.</span>Error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	value <span class="token operator">:=</span> keeper<span class="token punctuation">.</span><span class="token function">ResolveName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> sdk<span class="token punctuation">.</span><span class="token function">ErrUnknownRequest</span><span class="token punctuation">(</span><span class="token string">&quot;could not resolve name&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> codec<span class="token punctuation">.</span><span class="token function">MarshalJSONIndent</span><span class="token punctuation">(</span>keeper<span class="token punctuation">.</span>cdc<span class="token punctuation">,</span> QueryResResolve<span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;could not marshal result to JSON&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// nolint: unparam</span>
<span class="token keyword">func</span> <span class="token function">queryWhois</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> path <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> req abci<span class="token punctuation">.</span>RequestQuery<span class="token punctuation">,</span> keeper Keeper<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> sdk<span class="token punctuation">.</span>Error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	whois <span class="token operator">:=</span> keeper<span class="token punctuation">.</span><span class="token function">GetWhois</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> codec<span class="token punctuation">.</span><span class="token function">MarshalJSONIndent</span><span class="token punctuation">(</span>keeper<span class="token punctuation">.</span>cdc<span class="token punctuation">,</span> whois<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;could not marshal result to JSON&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">queryNames</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req abci<span class="token punctuation">.</span>RequestQuery<span class="token punctuation">,</span> keeper Keeper<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> sdk<span class="token punctuation">.</span>Error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> namesList QueryResNames

	iterator <span class="token operator">:=</span> keeper<span class="token punctuation">.</span><span class="token function">GetNamesIterator</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token punctuation">;</span> iterator<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iterator<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		namesList <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>namesList<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> codec<span class="token punctuation">.</span><span class="token function">MarshalJSONIndent</span><span class="token punctuation">(</span>keeper<span class="token punctuation">.</span>cdc<span class="token punctuation">,</span> namesList<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;could not marshal result to JSON&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Notes on the above code:</p> <ul><li>Here your <code>Keeper</code>'s getters and setters come into heavy use. When building any other applications that use this module you may need to go back and define more getters/setters to access the pieces of state you need.</li> <li>By convention, each output type should be something that is both JSON marshallable and stringable (implements the Golang <code>fmt.Stringer</code> interface). The returned bytes should be the JSON encoding of the output result.
<ul><li>So for the output type of <code>resolve</code> we wrap the resolution string in a struct called <code>QueryResResolve</code> which is both JSON marshallable and has a <code>.String()</code> method.</li> <li>For the output of Whois, the normal Whois struct is already JSON marshalable, but we need to add a <code>.String()</code> method on it.</li> <li>Same for the output of a names query, a <code>[]string</code> is already natively marshalable, but we want to add a <code>.String()</code> method on it.</li></ul></li> <li>The type Whois is not defined in the <code>./x/nameservice/types/querier.go</code> file because it is created in the <code>./x/nameservice/types/types.go</code> file.</li></ul> <h3 id="now-that-you-have-ways-to-mutate-and-view-your-module-state-it-s-time-to-put-the-finishing-touches-on-it-define-the-vairables-and-types-you-would-like-to-bring-to-the-top-level-of-the-module-alias-go"><a href="#now-that-you-have-ways-to-mutate-and-view-your-module-state-it-s-time-to-put-the-finishing-touches-on-it-define-the-vairables-and-types-you-would-like-to-bring-to-the-top-level-of-the-module-alias-go" aria-hidden="true" class="header-anchor">#</a> Now that you have ways to mutate and view your module state it's time to put the finishing touches on it! Define the vairables and types you would like to bring to the top level of the module. <a href="/tutorial/alias.html">alias.go</a></h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.358745d0.js" defer></script><script src="/assets/js/40.29b6dbc5.js" defer></script>
  </body>
</html>
