<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NameService 模块的 REST 接口</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.0fa35ecc.css" as="style"><link rel="preload" href="/assets/js/app.358745d0.js" as="script"><link rel="preload" href="/assets/js/24.6efbd344.js" as="script"><link rel="prefetch" href="/assets/js/10.ed56b2dd.js"><link rel="prefetch" href="/assets/js/11.b9448339.js"><link rel="prefetch" href="/assets/js/12.d9540af2.js"><link rel="prefetch" href="/assets/js/13.8738af6e.js"><link rel="prefetch" href="/assets/js/14.7ef7ba9a.js"><link rel="prefetch" href="/assets/js/15.01af3069.js"><link rel="prefetch" href="/assets/js/16.5f272536.js"><link rel="prefetch" href="/assets/js/17.950b1488.js"><link rel="prefetch" href="/assets/js/18.97cd0ce2.js"><link rel="prefetch" href="/assets/js/19.c15b4c92.js"><link rel="prefetch" href="/assets/js/2.7459dab1.js"><link rel="prefetch" href="/assets/js/20.46ad9e71.js"><link rel="prefetch" href="/assets/js/21.1aaf8749.js"><link rel="prefetch" href="/assets/js/22.ed2cbdbe.js"><link rel="prefetch" href="/assets/js/23.d29efe89.js"><link rel="prefetch" href="/assets/js/25.99eafa78.js"><link rel="prefetch" href="/assets/js/26.59c51545.js"><link rel="prefetch" href="/assets/js/27.09db857f.js"><link rel="prefetch" href="/assets/js/28.de9e6f97.js"><link rel="prefetch" href="/assets/js/29.a95ec837.js"><link rel="prefetch" href="/assets/js/3.3b8bb6a2.js"><link rel="prefetch" href="/assets/js/30.ec4f2e27.js"><link rel="prefetch" href="/assets/js/31.39335b08.js"><link rel="prefetch" href="/assets/js/32.5e4a40ba.js"><link rel="prefetch" href="/assets/js/33.2d12c22c.js"><link rel="prefetch" href="/assets/js/34.6a06e4fa.js"><link rel="prefetch" href="/assets/js/35.37ad73ec.js"><link rel="prefetch" href="/assets/js/36.c90ef3a4.js"><link rel="prefetch" href="/assets/js/37.fcf1b3b5.js"><link rel="prefetch" href="/assets/js/38.549dbd91.js"><link rel="prefetch" href="/assets/js/39.c25f4a9a.js"><link rel="prefetch" href="/assets/js/4.ff53f1d1.js"><link rel="prefetch" href="/assets/js/40.29b6dbc5.js"><link rel="prefetch" href="/assets/js/41.003066df.js"><link rel="prefetch" href="/assets/js/42.59cc5a5a.js"><link rel="prefetch" href="/assets/js/43.5877f03f.js"><link rel="prefetch" href="/assets/js/44.97ed4d02.js"><link rel="prefetch" href="/assets/js/45.2be01aab.js"><link rel="prefetch" href="/assets/js/5.d936167e.js"><link rel="prefetch" href="/assets/js/6.f824f7e2.js"><link rel="prefetch" href="/assets/js/7.e6534aea.js"><link rel="prefetch" href="/assets/js/8.1b43487c.js"><link rel="prefetch" href="/assets/js/9.a7040e01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0fa35ecc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="nameservice-模块的-rest-接口"><a href="#nameservice-模块的-rest-接口" aria-hidden="true" class="header-anchor">#</a> NameService 模块的 REST 接口</h1> <p>你的模块还可以公开 REST 接口，提供程序访问模块的功能。。首先创建一个文件来保存HTTP的handler：</p> <ul><li><code>./x/nameservice/client/rest/rest.go</code></li></ul> <p>引入模块和定义常量：</p> <blockquote><p>你的应用程序需要导入你刚编写的代码。这里导入路径设置为此存储库（github.com/cosmos/sdk-application-tutorial/x/nameservice）。如果您是在自己的仓库中进行的前面的操作，则需要更改导入路径（github.com/{.Username}/{.Project.Repo}/x/nameservice）。</p></blockquote> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> rest

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>

	<span class="token string">&quot;github.com/cosmos/cosmos-sdk/client/context&quot;</span>
	clientrest <span class="token string">&quot;github.com/cosmos/cosmos-sdk/client/rest&quot;</span>
	<span class="token string">&quot;github.com/cosmos/cosmos-sdk/codec&quot;</span>
	sdk <span class="token string">&quot;github.com/cosmos/cosmos-sdk/types&quot;</span>
	<span class="token string">&quot;github.com/cosmos/cosmos-sdk/types/rest&quot;</span>
	<span class="token string">&quot;github.com/cosmos/sdk-application-tutorial/x/nameservice&quot;</span>

	<span class="token string">&quot;github.com/gorilla/mux&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	restName <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="registerroutes"><a href="#registerroutes" aria-hidden="true" class="header-anchor">#</a> RegisterRoutes</h3> <p>首先在<code>RegisterRoutes</code>函数中为模块定义REST客户端接口。路由都以模块名称开头，以防止命名空间与其他模块的路径冲突：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// RegisterRoutes - Central function to define routes that get registered by the main application</span>
<span class="token keyword">func</span> <span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">,</span> r <span class="token operator">*</span>mux<span class="token punctuation">.</span>Router<span class="token punctuation">,</span> cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> storeName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;/%s/names&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">buyNameHandler</span><span class="token punctuation">(</span>cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;/%s/names&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">setNameHandler</span><span class="token punctuation">(</span>cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">&quot;PUT&quot;</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;/%s/names/{%s}&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> restName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolveNameHandler</span><span class="token punctuation">(</span>cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">,</span> storeName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;/%s/names/{%s}/whois&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> restName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">whoIsHandler</span><span class="token punctuation">(</span>cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">,</span> storeName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="query-handlers"><a href="#query-handlers" aria-hidden="true" class="header-anchor">#</a> Query Handlers</h3> <p>接下来，是时候定义上面提到的处理程序了。这些与前面定义的CLI方法非常相似。首先开始<code>whois</code>和<code>resolve</code>查询：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">resolveNameHandler</span><span class="token punctuation">(</span>cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">,</span> storeName <span class="token builtin">string</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		vars <span class="token operator">:=</span> mux<span class="token punctuation">.</span><span class="token function">Vars</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
		paramType <span class="token operator">:=</span> vars<span class="token punctuation">[</span>restName<span class="token punctuation">]</span>

		res<span class="token punctuation">,</span> err <span class="token operator">:=</span> cliCtx<span class="token punctuation">.</span><span class="token function">QueryWithData</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;custom/%s/resolve/%s&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> paramType<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusNotFound<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		rest<span class="token punctuation">.</span><span class="token function">PostProcessResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> res<span class="token punctuation">,</span> cliCtx<span class="token punctuation">.</span>Indent<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">whoIsHandler</span><span class="token punctuation">(</span>cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">,</span> storeName <span class="token builtin">string</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		vars <span class="token operator">:=</span> mux<span class="token punctuation">.</span><span class="token function">Vars</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
		paramType <span class="token operator">:=</span> vars<span class="token punctuation">[</span>restName<span class="token punctuation">]</span>

		res<span class="token punctuation">,</span> err <span class="token operator">:=</span> cliCtx<span class="token punctuation">.</span><span class="token function">QueryWithData</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;custom/%s/whois/%s&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">,</span> paramType<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusNotFound<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		rest<span class="token punctuation">.</span><span class="token function">PostProcessResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> res<span class="token punctuation">,</span> cliCtx<span class="token punctuation">.</span>Indent<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">namesHandler</span><span class="token punctuation">(</span>cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">,</span> storeName <span class="token builtin">string</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">,</span> err <span class="token operator">:=</span> cliCtx<span class="token punctuation">.</span><span class="token function">QueryWithData</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;custom/%s/names&quot;</span><span class="token punctuation">,</span> storeName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusNotFound<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		rest<span class="token punctuation">.</span><span class="token function">PostProcessResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> res<span class="token punctuation">,</span> cliCtx<span class="token punctuation">.</span>Indent<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述代码要注意：</p> <ul><li>请注意，我们使用相同的<code>cliCtx.QueryWithData</code>函数来获取数据</li> <li>这些函数与相应的CLI功能几乎相同</li></ul> <h3 id="tx-handlers"><a href="#tx-handlers" aria-hidden="true" class="header-anchor">#</a> Tx Handlers</h3> <p>现在定义 buyName 和 setName 交易路由。 请注意，这些实际上并不能将交易发送进行买入和设置名称。 这需要跟交易请求一起发送发送密码，将是一个安全问题。 相反，这些端点构建并返回每个特定交易，然后可以以安全的方式对其进行签名，然后使用标准端点（如/ txs）将其广播到网络。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> buyNameReq <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	BaseReq rest<span class="token punctuation">.</span>BaseReq <span class="token string">`json:&quot;base_req&quot;`</span>
	Name    <span class="token builtin">string</span>       <span class="token string">`json:&quot;name&quot;`</span>
	Amount  <span class="token builtin">string</span>       <span class="token string">`json:&quot;amount&quot;`</span>
	Buyer   <span class="token builtin">string</span>       <span class="token string">`json:&quot;buyer&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">buyNameHandler</span><span class="token punctuation">(</span>cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> req buyNameReq

		<span class="token keyword">if</span> <span class="token operator">!</span>rest<span class="token punctuation">.</span><span class="token function">ReadRESTReq</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> <span class="token string">&quot;failed to parse request&quot;</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		baseReq <span class="token operator">:=</span> req<span class="token punctuation">.</span>BaseReq<span class="token punctuation">.</span><span class="token function">Sanitize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>baseReq<span class="token punctuation">.</span><span class="token function">ValidateBasic</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		addr<span class="token punctuation">,</span> err <span class="token operator">:=</span> sdk<span class="token punctuation">.</span><span class="token function">AccAddressFromBech32</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Buyer<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		coins<span class="token punctuation">,</span> err <span class="token operator">:=</span> sdk<span class="token punctuation">.</span><span class="token function">ParseCoins</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Amount<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// create the message</span>
		msg <span class="token operator">:=</span> nameservice<span class="token punctuation">.</span><span class="token function">NewMsgBuyName</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> coins<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
		err <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">ValidateBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		clientrest<span class="token punctuation">.</span><span class="token function">WriteGenerateStdTxResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">,</span> baseReq<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>sdk<span class="token punctuation">.</span>Msg<span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> setNameReq <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	BaseReq rest<span class="token punctuation">.</span>BaseReq <span class="token string">`json:&quot;base_req&quot;`</span>
	Name    <span class="token builtin">string</span>       <span class="token string">`json:&quot;name&quot;`</span>
	Value   <span class="token builtin">string</span>       <span class="token string">`json:&quot;value&quot;`</span>
	Owner   <span class="token builtin">string</span>       <span class="token string">`json:&quot;owner&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">setNameHandler</span><span class="token punctuation">(</span>cdc <span class="token operator">*</span>codec<span class="token punctuation">.</span>Codec<span class="token punctuation">,</span> cliCtx context<span class="token punctuation">.</span>CLIContext<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> req setNameReq
		<span class="token keyword">if</span> <span class="token operator">!</span>rest<span class="token punctuation">.</span><span class="token function">ReadRESTReq</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> <span class="token string">&quot;failed to parse request&quot;</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		baseReq <span class="token operator">:=</span> req<span class="token punctuation">.</span>BaseReq<span class="token punctuation">.</span><span class="token function">Sanitize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>baseReq<span class="token punctuation">.</span><span class="token function">ValidateBasic</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		addr<span class="token punctuation">,</span> err <span class="token operator">:=</span> sdk<span class="token punctuation">.</span><span class="token function">AccAddressFromBech32</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Owner<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// create the message</span>
		msg <span class="token operator">:=</span> nameservice<span class="token punctuation">.</span><span class="token function">NewMsgSetName</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
		err <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">ValidateBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			rest<span class="token punctuation">.</span><span class="token function">WriteErrorResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		clientrest<span class="token punctuation">.</span><span class="token function">WriteGenerateStdTxResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cdc<span class="token punctuation">,</span> cliCtx<span class="token punctuation">,</span> baseReq<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>sdk<span class="token punctuation">.</span>Msg<span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意上述代码：</p> <ul><li><a href="https://godoc.org/github.com/cosmos/cosmos-sdk/client/utils#BaseReq" target="_blank" rel="noopener noreferrer"><code>BaseReq</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>包含用于进行交易的基本必填字段（使用哪个密钥，如何解码，使用哪条链等等）并且如所示被设计成嵌入形式。</li> <li><code>baseReq.ValidateBasic</code>和<code>utils.CompleteAndBroadcastTxREST</code>为你设置响应代码，因此你需担心在使用这些函数时处理错误或成功。</li></ul> <h3 id="现在你的模块已经具备了全部功能，需要与-cosmos-sdk-应用合并。"><a href="#现在你的模块已经具备了全部功能，需要与-cosmos-sdk-应用合并。" aria-hidden="true" class="header-anchor">#</a> 现在你的模块已经具备了全部功能，需要<a href="/tutorial/cn/12-app-complete.html">与 Cosmos SDK 应用合并</a>。</h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.358745d0.js" defer></script><script src="/assets/js/24.6efbd344.js" defer></script>
  </body>
</html>
