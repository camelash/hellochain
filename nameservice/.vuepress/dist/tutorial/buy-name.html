<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Buy Name</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.0fa35ecc.css" as="style"><link rel="preload" href="/assets/js/app.358745d0.js" as="script"><link rel="preload" href="/assets/js/12.d9540af2.js" as="script"><link rel="prefetch" href="/assets/js/10.ed56b2dd.js"><link rel="prefetch" href="/assets/js/11.b9448339.js"><link rel="prefetch" href="/assets/js/13.8738af6e.js"><link rel="prefetch" href="/assets/js/14.7ef7ba9a.js"><link rel="prefetch" href="/assets/js/15.01af3069.js"><link rel="prefetch" href="/assets/js/16.5f272536.js"><link rel="prefetch" href="/assets/js/17.950b1488.js"><link rel="prefetch" href="/assets/js/18.97cd0ce2.js"><link rel="prefetch" href="/assets/js/19.c15b4c92.js"><link rel="prefetch" href="/assets/js/2.7459dab1.js"><link rel="prefetch" href="/assets/js/20.46ad9e71.js"><link rel="prefetch" href="/assets/js/21.1aaf8749.js"><link rel="prefetch" href="/assets/js/22.ed2cbdbe.js"><link rel="prefetch" href="/assets/js/23.d29efe89.js"><link rel="prefetch" href="/assets/js/24.6efbd344.js"><link rel="prefetch" href="/assets/js/25.99eafa78.js"><link rel="prefetch" href="/assets/js/26.59c51545.js"><link rel="prefetch" href="/assets/js/27.09db857f.js"><link rel="prefetch" href="/assets/js/28.de9e6f97.js"><link rel="prefetch" href="/assets/js/29.a95ec837.js"><link rel="prefetch" href="/assets/js/3.3b8bb6a2.js"><link rel="prefetch" href="/assets/js/30.ec4f2e27.js"><link rel="prefetch" href="/assets/js/31.39335b08.js"><link rel="prefetch" href="/assets/js/32.5e4a40ba.js"><link rel="prefetch" href="/assets/js/33.2d12c22c.js"><link rel="prefetch" href="/assets/js/34.6a06e4fa.js"><link rel="prefetch" href="/assets/js/35.37ad73ec.js"><link rel="prefetch" href="/assets/js/36.c90ef3a4.js"><link rel="prefetch" href="/assets/js/37.fcf1b3b5.js"><link rel="prefetch" href="/assets/js/38.549dbd91.js"><link rel="prefetch" href="/assets/js/39.c25f4a9a.js"><link rel="prefetch" href="/assets/js/4.ff53f1d1.js"><link rel="prefetch" href="/assets/js/40.29b6dbc5.js"><link rel="prefetch" href="/assets/js/41.003066df.js"><link rel="prefetch" href="/assets/js/42.59cc5a5a.js"><link rel="prefetch" href="/assets/js/43.5877f03f.js"><link rel="prefetch" href="/assets/js/44.97ed4d02.js"><link rel="prefetch" href="/assets/js/45.2be01aab.js"><link rel="prefetch" href="/assets/js/5.d936167e.js"><link rel="prefetch" href="/assets/js/6.f824f7e2.js"><link rel="prefetch" href="/assets/js/7.e6534aea.js"><link rel="prefetch" href="/assets/js/8.1b43487c.js"><link rel="prefetch" href="/assets/js/9.a7040e01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0fa35ecc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="buy-name"><a href="#buy-name" aria-hidden="true" class="header-anchor">#</a> Buy Name</h1> <h2 id="msg"><a href="#msg" aria-hidden="true" class="header-anchor">#</a> Msg</h2> <p>Now it is time to define the <code>Msg</code> for buying names and add it to the <code>./x/nameservice/types/msgs.go</code> file. This code is very similar to <code>SetName</code>:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// MsgBuyName defines the BuyName message</span>
<span class="token keyword">type</span> MsgBuyName <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name  <span class="token builtin">string</span>         <span class="token string">`json:&quot;name&quot;`</span>
	Bid   sdk<span class="token punctuation">.</span>Coins      <span class="token string">`json:&quot;bid&quot;`</span>
	Buyer sdk<span class="token punctuation">.</span>AccAddress <span class="token string">`json:&quot;buyer&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewMsgBuyName is the constructor function for MsgBuyName</span>
<span class="token keyword">func</span> <span class="token function">NewMsgBuyName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> bid sdk<span class="token punctuation">.</span>Coins<span class="token punctuation">,</span> buyer sdk<span class="token punctuation">.</span>AccAddress<span class="token punctuation">)</span> MsgBuyName <span class="token punctuation">{</span>
	<span class="token keyword">return</span> MsgBuyName<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span>  name<span class="token punctuation">,</span>
		Bid<span class="token punctuation">:</span>   bid<span class="token punctuation">,</span>
		Buyer<span class="token punctuation">:</span> buyer<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Route should return the name of the module</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg MsgBuyName<span class="token punctuation">)</span> <span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> RouterKey <span class="token punctuation">}</span>

<span class="token comment">// Type should return the action</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg MsgBuyName<span class="token punctuation">)</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;buy_name&quot;</span> <span class="token punctuation">}</span>

<span class="token comment">// ValidateBasic runs stateless checks on the message</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg MsgBuyName<span class="token punctuation">)</span> <span class="token function">ValidateBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> sdk<span class="token punctuation">.</span>Error <span class="token punctuation">{</span>
	<span class="token keyword">if</span> msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">.</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrInvalidAddress</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrUnknownRequest</span><span class="token punctuation">(</span><span class="token string">&quot;Name cannot be empty&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>msg<span class="token punctuation">.</span>Bid<span class="token punctuation">.</span><span class="token function">IsAllPositive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrInsufficientCoins</span><span class="token punctuation">(</span><span class="token string">&quot;Bids must be positive&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// GetSignBytes encodes the message for signing</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg MsgBuyName<span class="token punctuation">)</span> <span class="token function">GetSignBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">MustSortJSON</span><span class="token punctuation">(</span>ModuleCdc<span class="token punctuation">.</span><span class="token function">MustMarshalJSON</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// GetSigners defines whose signature is required</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg MsgBuyName<span class="token punctuation">)</span> <span class="token function">GetSigners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>sdk<span class="token punctuation">.</span>AccAddress <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>sdk<span class="token punctuation">.</span>AccAddress<span class="token punctuation">{</span>msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next, in the <code>./x/nameservice/handler.go</code> file, add the <code>MsgBuyName</code> handler to the module router:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// NewHandler returns a handler for &quot;nameservice&quot; type messages.</span>
<span class="token keyword">func</span> <span class="token function">NewHandler</span><span class="token punctuation">(</span>keeper Keeper<span class="token punctuation">)</span> sdk<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> msg sdk<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span> sdk<span class="token punctuation">.</span>Result <span class="token punctuation">{</span>
		<span class="token keyword">switch</span> msg <span class="token operator">:=</span> msg<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> MsgSetName<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token function">handleMsgSetName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> keeper<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
		<span class="token keyword">case</span> MsgBuyName<span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token function">handleMsgBuyName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> keeper<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			errMsg <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Unrecognized nameservice Msg type: %v&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrUnknownRequest</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Finally, define the <code>BuyName</code> <code>handler</code> function which performs the state transitions triggered by the message. Keep in mind that at this point the message has had its <code>ValidateBasic</code> function run so there has been some input verification. However, <code>ValidateBasic</code> cannot query application state. Validation logic that is dependent on network state (e.g. account balances) should be performed in the <code>handler</code> function.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Handle a message to buy name</span>
<span class="token keyword">func</span> <span class="token function">handleMsgBuyName</span><span class="token punctuation">(</span>ctx sdk<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> keeper Keeper<span class="token punctuation">,</span> msg MsgBuyName<span class="token punctuation">)</span> sdk<span class="token punctuation">.</span>Result <span class="token punctuation">{</span>
	<span class="token keyword">if</span> keeper<span class="token punctuation">.</span><span class="token function">GetPrice</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsAllGT</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Bid<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Checks if the the bid price is greater than the price paid by the current owner</span>
		<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrInsufficientCoins</span><span class="token punctuation">(</span><span class="token string">&quot;Bid not high enough&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// If not, throw an error</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> keeper<span class="token punctuation">.</span><span class="token function">HasOwner</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		err <span class="token operator">:=</span> keeper<span class="token punctuation">.</span>coinKeeper<span class="token punctuation">.</span><span class="token function">SendCoins</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">,</span> keeper<span class="token punctuation">.</span><span class="token function">GetOwner</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Bid<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrInsufficientCoins</span><span class="token punctuation">(</span><span class="token string">&quot;Buyer does not have enough coins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> keeper<span class="token punctuation">.</span>coinKeeper<span class="token punctuation">.</span><span class="token function">SubtractCoins</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Bid<span class="token punctuation">)</span> <span class="token comment">// If so, deduct the Bid amount from the sender</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> sdk<span class="token punctuation">.</span><span class="token function">ErrInsufficientCoins</span><span class="token punctuation">(</span><span class="token string">&quot;Buyer does not have enough coins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	keeper<span class="token punctuation">.</span><span class="token function">SetOwner</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Buyer<span class="token punctuation">)</span>
	keeper<span class="token punctuation">.</span><span class="token function">SetPrice</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Bid<span class="token punctuation">)</span>
	<span class="token keyword">return</span> sdk<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>First check to make sure that the bid is higher than the current price. Then, check to see whether the name already has an owner. If it does, the former owner will receive the money from the <code>Buyer</code>.</p> <p>If there is no owner, your <code>nameservice</code> module &quot;burns&quot; (i.e. sends to an unrecoverable address) the coins from the <code>Buyer</code>.</p> <p>If either <code>SubtractCoins</code> or <code>SendCoins</code> returns a non-nil error, the handler throws an error, reverting the state transition. Otherwise, using the getters and setters defined on the <code>Keeper</code> earlier, the handler sets the buyer to the new owner and sets the new price to be the current bid.</p> <blockquote><p><em><em>NOTE</em></em>: This handler uses functions from the <code>coinKeeper</code> to perform currency operations. If your application is performing currency operations you may want to take a look at the <a href="https://godoc.org/github.com/cosmos/cosmos-sdk/x/bank#BaseKeeper" target="_blank" rel="noopener noreferrer">godocs for this module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to see what functions it exposes.</p></blockquote> <h3 id="now-that-you-have-your-msgs-and-handlers-defined-it-s-time-to-learn-about-making-the-data-from-these-transactions-available-for-querying"><a href="#now-that-you-have-your-msgs-and-handlers-defined-it-s-time-to-learn-about-making-the-data-from-these-transactions-available-for-querying" aria-hidden="true" class="header-anchor">#</a> Now that you have your <code>Msgs</code> and <code>Handlers</code> defined it's time to learn about making the data from these transactions <a href="/tutorial/queriers.html">available for querying</a>!</h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.358745d0.js" defer></script><script src="/assets/js/12.d9540af2.js" defer></script>
  </body>
</html>
